#include "myfir.h"

extern uint16_t myfiri = 0;

extern float32_t INPUTBUFF[TEST_LENGTH_SAMPLES] = {0};
extern float32_t OUTPUTBUFF[TEST_LENGTH_SAMPLES] = {0};

static float32_t firStateF32_48[BLOCK_SIZE+NUM_TAPS-1] = {0}; /* 状态缓存，大小numTaps + blockSize - 1*/

//extern float Input_buffer[TEST_LENGTH_SAMPLES] = {0}; /* 采样点 */

//extern float Output_buffer[TEST_LENGTH_SAMPLES] = {0}; /* 滤波后的输出 */

arm_fir_instance_f32 S;



/* 低通滤波器系数 通过fadtool获取*/

//const float32_t B[33] = {
//   0.001429288713987, 0.005758635998845, 0.002549475871168, -0.01000242159132,
//   -0.01477117677301, 0.008024488386627,  0.03538903404689,  0.01430109608086,
//   -0.04713837318165, -0.05733292231342,  0.02580895060025,  0.09561475111827,
//    0.03292309324862, -0.09362423450565,  -0.0992448933571,  0.03924595788522,
//     0.1284730052847,  0.03924595788522,  -0.0992448933571, -0.09362423450565,
//    0.03292309324862,  0.09561475111827,  0.02580895060025, -0.05733292231342,
//   -0.04713837318165,  0.01430109608086,  0.03538903404689, 0.008024488386627,
//   -0.01477117677301, -0.01000242159132, 0.002549475871168, 0.005758635998845,
//   0.001429288713987
//};

//
//采样率42000
//中心频率1000
//
const float32_t B[33] = {
   -0.00606850559575,-0.005738428121864,-0.005964284683859,-0.005974698546638,
  -0.004965262264821,-0.002210715253094, 0.002831044983267,  0.01043594615686,
    0.02056207642551,  0.03283600493719,   0.0465791879545,  0.06087176049007,
    0.07464652083827,  0.08680226961557,  0.09632330415641,   0.1023910781041,
     0.1044749117178,   0.1023910781041,  0.09632330415641,  0.08680226961557,
    0.07464652083827,  0.06087176049007,   0.0465791879545,  0.03283600493719,
    0.02056207642551,  0.01043594615686, 0.002831044983267,-0.002210715253094,
  -0.004965262264821,-0.005974698546638,-0.005964284683859,-0.005738428121864,
   -0.00606850559575
};

////
////采样率42000
////中心频率3000
////
//const float32_t B[33] = {
//   0.005670207530323, 0.009109529086247,  0.01310421201079,  0.01618638591975,
//    0.01528351415385, 0.007231538556385,-0.009260718187342, -0.03212276054929,
//   -0.05570585724731, -0.07214443861955, -0.07394263001546, -0.05687652573915,
//   -0.02208500099766,  0.02355129111079,  0.06904297469226,   0.1024878668658,
//     0.1147716336096,   0.1024878668658,  0.06904297469226,  0.02355129111079,
//   -0.02208500099766, -0.05687652573915, -0.07394263001546, -0.07214443861955,
//   -0.05570585724731, -0.03212276054929,-0.009260718187342, 0.007231538556385,
//    0.01528351415385,  0.01618638591975,  0.01310421201079, 0.009109529086247,
//   0.005670207530323
//};

void arm_fir_f32_lp(float32_t *Input_buffer,float32_t *Output_buffer,uint32_t blockSize)
{
    float32_t *inputF32,*outputF32;

    inputF32 = Input_buffer;
    outputF32 = Output_buffer;

    arm_fir_f32(&S,inputF32,outputF32,block_size);
}

void arm_fir32_init(uit32_t block_size)
{
	arm_fir_init_f32(&S,NUM_TAPS,(float32_t *)&B[0],&firStateF32_48[0],block_size);
}


///* 块数据FIR滤波 */
/*********************************************
//uint32_t block_size = BLOCK_SIZE;

//arm_fir32_init(block_size);

//for(i=0; i < numBlocks; i++)

//{
//arm_fir_f32_lp(inputF32 + (i * blockSize), outputF32 + (i * blockSize), blockSize);

//}
*************************************************/




///* 实时FIR滤波 */
/*********************************************
//uint32_t inputdata;  //待滤波数

//uint32_t outputdata;

//arm_fir_f32_lp(&inputF32, &outputdata, 1);

*************************************************/





